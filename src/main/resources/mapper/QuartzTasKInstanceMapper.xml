<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="io.choerodon.asgard.infra.mapper.SagaInstanceMapper">

    <select id="selectLastTime" databaseId="mysql" resultType="java.util.Date">
     SELECT actual_start_time FROM asgard_quartz_task_instance
     WHERE task_id = #{taskId}
     ORDER BY CREATION_DATE DESC
     LIMIT 1
  </select>

    <select id="selectLastTime" databaseId="oracle" resultType="java.util.Date">
    <![CDATA[
      SELECT * FROM (
         SELECT actual_start_time FROM asgard_quartz_task_instance
         WHERE task_id = #{taskId}
         ORDER BY CREATION_DATE DESC
      ) WHERE ROWNUM <= 1
    ]]>
</select>

    <select id="countUnCompletedInstance"  resultType="java.lang.Integer">
        SELECT COUNT(*) FROM asgard_quartz_task_instance
        WHERE status != COMPLETED AND task_id = #{taskId}
    </select>

</mapper>
